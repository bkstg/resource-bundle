{% extends 'BkstgCoreBundle::layout.html.twig' %}

{# title and description for base template #}
{% block title %}Resources{% endblock %}
{% block description %}
  Resources are useful documents related to the production, editors can add
  resources and editors can edit and delete their own resources.  Administrators
  can edit or delete any resource.
{% endblock %}

{# render the actual content #}
{% block content %}
    {% if is_granted("ROLE_EDITOR", null) %}
    <div class="modal fade form-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Add new resource</h4>
          </div>
          <div class="modal-body">
            {{ form_start(form) }}
              {{ form_errors(form) }}

              {# render form elements #}
              {% for item in form %}
                {% if "hidden" not in item.vars.block_prefixes %}
                  <div class="form-group">
                    {{ form_label(item, label|default(null), { 'label_attr': { 'class': 'hidden'}}) }}
                    {{ form_widget(item, { 'attr': { 'placeholder': item.vars.label|default(null), 'class': 'form-control'}}) }}
                  </div>
                {% endif %}
              {% endfor %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <input type="submit" class="btn btn-primary" value="Add resource" />
          </div>
          {{ form_end(form) }}
        </div>
      </div>
    </div>
  {% endif %}

  {# only an editor can add new resources #}
  <div class="panel panel-default">
    {% if is_granted("ROLE_EDITOR", null) %}
        <div class="panel-heading">
          <a class="btn btn-default" href="#" data-toggle="modal" data-target=".form-modal"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add new resource</a></li>
        </div>
    {% endif %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <td><strong>Name</strong></td>
            <td><strong>Added by</strong></td>
            <td><strong>Added on</strong></td>
            <td></td>
          </tr>
        </thead>
        <tbody>

        {# print resources #}
        {% for resource in resources %}
          <tr>
            <td>{{ resource.title }}</td>
            <td>{{ resource.user }}</td>
            <td>{{ resource.created|date("F jS \\a\\t g:ia") }}</td>
            <td align="right">
              <div class="resource-actions">
                <div class="button-group">

                  {# view and download are always available #}
                  <a class="btn btn-default" href="{{ path('bkstg_resource_view_resource', { 'resource': resource.id }) }}"><span class="glyphicon glyphicon-file" aria-hidden="true"></span> view</a></li>
                  <a class="btn btn-default" href="{{ path('bkstg_resource_download_resource', { 'resource': resource.id }) }}"><span class="glyphicon glyphicon-download" aria-hidden="true"></span> download</a>

                  {# user can delete this resource #}
                  {% if is_granted("edit", resource) %}
                    <a class="btn btn-danger" href="{{ path('bkstg_resource_delete_resource', { 'resource': resource.id }) }}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> delete</a>
                  {% endif %}
                </div>
              </div>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4">No resources found.</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {# render post paginator #}
  {{ knp_pagination_render(resources) }}
{% endblock %}
